<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ciicsh.gto.afsupportcenter.socialsecurity.soccommandservice.dao.SsComAccountMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMapDTO" extends="BaseResultMap"
               type="com.ciicsh.gto.afsupportcenter.socialsecurity.soccommandservice.dto.SsComAccountDTO">
        <!-- cmy_company -->
        <result column="company_id" property="companyId"/>
        <result column="title" property="title"/>
    </resultMap>

    <select id="queryByEmpTaskId" resultMap="BaseResultMapDTO">
        select ca.*
            ,c.company_id,c.title
            from ss_com_account ca
            LEFT JOIN ss_account_com_relation ssac on ca.com_account_id = ssac.com_account_id
            LEFT JOIN cmy_company c on c.company_id = ssac.company_id
            WHERE 1 = 1
            and ca.is_active = 1
            and ssac.is_active = 1
            and c.is_active = 1
            and EXISTS(select 1 from ss_emp_task et LEFT JOIN ss_emp_archive ea on et.emp_archived_id = ea.emp_archived_id where et.is_active = 1 and ea.company_id = c.company_id and et.emp_task_id = #{empTaskId})
    </select>
</mapper>
