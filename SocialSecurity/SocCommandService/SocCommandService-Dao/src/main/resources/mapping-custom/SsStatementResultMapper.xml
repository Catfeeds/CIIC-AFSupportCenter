<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ciicsh.gto.afsupportcenter.socialsecurity.soccommandservice.dao.SsStatementResultMapper">


    <!-- 表单展示查询映射结果 -->
    <resultMap id="DtoResultMap" type="com.ciicsh.gto.afsupportcenter.socialsecurity.soccommandservice.dto.SsStatementResultDTO">
        <id column="statement_detail_id" jdbcType="BIGINT" property="statementDetailId" />
        <result column="statement_id" jdbcType="BIGINT" property="statementId" />
        <result column="employee_id" jdbcType="VARCHAR" property="employeeId" />
        <result column="employee_name" jdbcType="VARCHAR" property="employeeName" />
        <result column="change_type" jdbcType="INTEGER" property="changeType" />
        <result column="change_type_name" jdbcType="VARCHAR" property="changeTypeName" />
        <result column="project_type" jdbcType="INTEGER" property="projectType" />
        <result column="project_type_name" jdbcType="VARCHAR" property="projectTypeName" />
        <result column="ss_type" jdbcType="TINYINT" property="ssType" />
        <result column="ss_type_name" jdbcType="VARCHAR" property="ssTypeName" />
        <result column="imp_amount" jdbcType="DECIMAL" property="impAmount" />
        <result column="ss_amount" jdbcType="DECIMAL" property="ssAmount" />
        <result column="diff_amount" jdbcType="DECIMAL" property="diffAmount" />
        <result column="is_active" jdbcType="BIT" property="isActive" />
        <result column="created_time" property="createdTime" />
        <result column="modified_time" property="modifiedTime" />
        <result column="created_by" jdbcType="VARCHAR" property="createdBy" />
        <result column="modified_by" jdbcType="VARCHAR" property="modifiedBy" />
    </resultMap>

    <select id="statementResultQuery" parameterType="com.ciicsh.gto.afsupportcenter.socialsecurity.soccommandservice.dto.SsStatementResultDTO" resultMap="DtoResultMap">
        SELECT
          T1.*,T2.employee_name
        FROM
          ss_statement_result T1
        LEFT JOIN
          emp_employee T2
        ON
          T1.employee_id = T2.employee_id
        WHERE
          1=1
          AND T1.is_active = '1'
          AND T1.statement_id = #{statementId,jdbcType=BIGINT}
        ORDER BY
          T1.employee_id,T1.change_type,T1.ss_type,T1.project_type
    </select>
    <update id="cleanResultByStatementId" parameterType="com.ciicsh.gto.afsupportcenter.socialsecurity.soccommandservice.dto.SsStatementResultDTO">
        UPDATE
          ss_statement_result T1
        SET
          T1.is_active = 0,
          T1.modified_time = #{modifiedTime},
          T1.modified_by = #{modifiedBy,jdbcType=VARCHAR}

        WHERE
          T1.statement_id = #{statementId,jdbcType=BIGINT}
    </update>


</mapper>
