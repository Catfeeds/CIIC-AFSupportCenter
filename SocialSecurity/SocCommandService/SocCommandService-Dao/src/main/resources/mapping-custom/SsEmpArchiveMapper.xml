<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ciicsh.gto.afsupportcenter.socialsecurity.soccommandservice.dao.SsEmpArchiveMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMapDTO" extends="BaseResultMap"
               type="com.ciicsh.gto.afsupportcenter.socialsecurity.soccommandservice.bo.SsEmpArchiveBO">
        <result column="employee_id" property="employeeId"/>
        <result column="employee_name" property="employeeName"/>
        <result column="id_num" property="idNum"/>
        <result column="ss_account" property="ssAccount"/>
        <result column="ss_account_type" property="ssAccountType"/>
        <result column="settlement_area" property="settlementArea"/>
        <result column="title" property="title"/>
        <result column="com_account_name" property="comAccountName"/>
    </resultMap>
    <!-- 查询非新增和转入的雇员信息 -->
    <select id="queryByEmpTaskId" resultMap="BaseResultMapDTO">
        select
            ea.*,
            e.employee_name,
            e.id_num,
            sca.ss_account_type
            from ss_emp_archive ea
            LEFT JOIN emp_employee e on e.employee_id = ea.employee_id
            LEFT JOIN ss_com_account sca ON sca.com_account_id = ea.com_account_id AND sca.is_active =1
            WHERE 1 = 1
            and ea.is_active = 1
            and EXISTS(select 1 from ss_emp_task et where et.is_active = 1 and et.emp_archive_id = ea.emp_archive_id and et.emp_task_id = #{empTaskId})
    </select>

    <!--雇员查询-->
    <select id="queryEmployee" resultMap="BaseResultMapDTO">
        SELECT
        sea.emp_archive_id,
        emp.employee_id,
        emp.employee_name,
        emp.id_num,
        sca.ss_account,
        sea.archive_task_status,
        sca.ss_account_type,
        sca.settlement_area,
        sc.company_id,
        sc.title,
        sca.com_account_name,
        sea.start_month,
        sea.end_month,
        sea.ss_month,
        sea.in_date
        FROM ss_emp_archive sea
        LEFT JOIN sal_company sc ON sc.company_id=sea.company_id AND sc.is_active = 1
        LEFT JOIN emp_employee emp ON emp.employee_id =sea.employee_id
        LEFT JOIN ss_com_account sca ON sca.com_account_id=sea.com_account_id AND sca.is_active =1
        <where>
             sea.is_active = 1
            <if test="archiveTaskStatus != null">
                AND sea.archive_task_status = #{archiveTaskStatus}
            </if>
            <if test="title != null">
                AND sc.title LIKE CONCAT('%',#{title}, '%')
            </if>
            <if test="companyId != null">
                AND sea.company_id = #{companyId}
            </if>
            <if test="empClassify != null">
                AND sea.emp_classify = #{empClassify}
            </if>
            <if test="employeeName != null">
                AND emp.employee_name  LIKE CONCAT('%',#{employeeName}, '%')
            </if>
            <if test="employeeId != null">
                AND emp.employee_id = #{employeeId}
            </if>
            <if test="idNum != null">
                AND emp.id_num = #{idNum}
            </if>
            <if test="settlementArea != null">
                AND sca.settlement_area LIKE CONCAT('%',#{settlementArea}, '%')
            </if>
            <if test="ssAccount != null">
                AND sca.ss_account = #{ssAccount}
            </if>
            <if test="ssAccountType != null">
                AND sca.ss_account_type = #{ssAccountType}
            </if>
        </where>

    </select>

    <select id="queryEmployeeDetailInfo" resultMap="BaseResultMapDTO">
        SELECT
        sea.emp_archive_id,
        sc.company_id,
        sc.title,
        emp.employee_id,
        emp.employee_name,
        emp.id_num,
        sea.in_date,
        sea.ss_serial,
        sca.ss_account,
        sea.emp_classify,
        sea.out_date
        FROM ss_emp_archive sea
        LEFT JOIN sal_company sc ON sc.company_id=sea.company_id AND sc.is_active = 1
        LEFT JOIN emp_employee emp ON emp.employee_id =sea.employee_id
        LEFT JOIN ss_com_account sca ON sca.com_account_id=sea.com_account_id AND sca.is_active =1
        WHERE  sea.is_active = 1
        AND emp_archive_id = #{empArchiveId}
    </select>

</mapper>
