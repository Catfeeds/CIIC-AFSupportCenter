<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ciicsh.gto.afsupportcenter.socialsecurity.soccommandservice.dao.SsComTaskMapper">
    <resultMap id="ModelResultMap"
               type="com.ciicsh.gto.afsupportcenter.socialsecurity.soccommandservice.dto.SsComTaskDTO"
               extends="BaseResultMap">
        <result column="title" property="companyName"/>

    </resultMap>
    <!--查询企业任务单 会涉及到 结算区县-->
    <select id="queryNoProgressCompanyTask" resultMap="ModelResultMap">

        SELECT
        sct.company_id,
        sct.company_task_id,
        sct.task_category,
        sct.customer_id,
        sct.expire_date,
        sct.submitter_id,
        sct.submit_time,
        sct.submit_remark,
        cc.title
        FROM ss_com_task sct
        LEFT JOIN cmy_company cc ON sct.company_id = cc.company_id
        <where>
            AND sct.is_active = 1
            AND sct.task_status = 0
            <if test="companyName!= null">
                AND cc.title LIKE CONCAT('%', #{companyName}, '%')
            </if>
            <if test="taskCategory!= null">
                AND sct.task_category = #{taskCategory}
            </if>
            <if test="companyId!= null">
                AND sct.company_id = #{companyId}
            </if>
            <if test="submitTimeStart!= null">
                AND sct.submit_time <![CDATA[ >= ]]> #{submitTimeStart}
            </if>
            <if test="submitTimeEnd!= null ">
                AND sct.submit_time <![CDATA[ <= ]]> #{submitTimeEnd}
            </if>
        </where>


    </select>


    <select id="queryProgressingCompanyTask" resultMap="ModelResultMap">
    SELECT * FROM(
        SELECT
        sct.task_status,
        sct.company_id,
        sct.company_task_id,
        sct.task_category,
        sct.customer_id,
        sct.expire_date,
        sct.submitter_id,
        sct.submit_time,
        sct.submit_remark,
        cc.title
        FROM ss_com_task sct
        LEFT JOIN ss_com_account sca ON sct.com_account_id = sca.com_account_id
        LEFT JOIN cmy_company cc ON sct.company_id = cc.company_id
        <where>
            AND sct.is_active = 1
            <if test="accountType!= null ">
                AND sca.ss_account_type = #{accountType}
            </if>
            <if test="regionValue!= null ">
                AND sca.settlement_area LIKE CONCAT('%',#{regionValue}, '%')
            </if>
            <if test="taskStatus!= null ">
                AND sct.task_status = #{taskStatus}
            </if>

            <if test="companyName!= null">
                AND cc.title LIKE CONCAT('%', #{companyName}, '%')
            </if>
            <if test="taskCategory!= null">
                AND sct.task_category = #{taskCategory}
            </if>
            <if test="companyId!= null">
                AND sct.company_id = #{companyId}
            </if>
            <if test="submitTimeStart!= null">
                AND sct.submit_time <![CDATA[ >= ]]> #{submitTimeStart}
            </if>
            <if test="submitTimeEnd!= null ">
                AND sct.submit_time <![CDATA[ <= ]]> #{submitTimeEnd}
            </if>
        </where>
        )x
       <where>
            <if test="taskStatus== null ">
                AND x.task_status = 1 OR x.task_status = 2
            </if>
       </where>
    </select>
</mapper>
