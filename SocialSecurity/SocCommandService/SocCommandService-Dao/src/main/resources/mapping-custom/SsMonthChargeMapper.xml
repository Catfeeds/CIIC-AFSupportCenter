<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ciicsh.gto.afsupportcenter.socialsecurity.soccommandservice.dao.SsMonthChargeMapper">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.ciicsh.gto.afsupportcenter.socialsecurity.soccommandservice.entity.SsMonthCharge">
		<id column="month_charge_id" property="monthChargeId" />
		<result column="com_account_id" property="comAccountId" />
		<result column="ss_month" property="ssMonth" />
		<result column="emp_archive_id" property="empArchiveId" />
		<result column="base_amount" property="baseAmount" />
		<result column="total_amount" property="totalAmount" />
		<result column="cost_category" property="costCategory" />
		<result column="is_active" property="isActive" />
		<result column="created_time" property="createdTime" />
		<result column="modified_time" property="modifiedTime" />
		<result column="created_by" property="createdBy" />
		<result column="modified_by" property="modifiedBy" />
	</resultMap>
    <!--判断当月是否首次生成明细报表-->
    <select id="countIfMonthFirstReport" resultType="java.util.HashMap">
        SELECT count(1) AS count_mc FROM ss_month_charge mc
        WHERE mc.is_active=1
        AND ss_month={#}
    </select>

    <!--判断是否有新的任务单-->
    <select id="selectIfNewEmpTask" resultType="java.util.HashMap">
        <![CDATA[
        SELECT et.*
        FROM ss_emp_task et
        LEFT JOIN ss_emp_archive ea ON ea.emp_archive_id=et.emp_archive_id
        WHERE et.is_active=1
        AND et.handle_month={#}
        AND ea.com_account_id={#}
        AND EXISTS(
        SELECT 1 from (
        select MAX(mc.created_time) created_time FROM ss_month_charge mc
        WHERE mc.is_active=1
        AND mc.ss_month={#}
        AND mc.com_account_id={#})t WHERE t.created_time < = et.created_time
        )
        ]]>
    </select>
    <!--逻辑删除，按月份按企业社保账户，删除险种-->
    <update id="updateMonthChargeItem">

    </update>
    <!--逻辑删除，按月份按企业社保账户，删除雇员-->
    <update id="updateMonthCharge">

    </update>

<!--标准：按月查询标准数据,查询雇员费用段-->
    <select id="selectStandardEmpPeriod"  resultType="java.util.HashMap">
        <![CDATA[
        SELECT ebp.*
        FROM ss_emp_base_period ebp
        LEFT JOIN ss_emp_archive ea on ea.emp_archive_id=ebp.emp_archive_id and ea.com_account_id='客户社保账户ID'
        WHERE
        ebp.is_active=1
        AND '社保缴纳年月' BETWEEN ebp.start_month and ebp.end_month
        AND ebp.ss_month<>'社保年月'
        AND ebp.ss_month_stop<>'社保缴纳年月'
        ]]>

    </select>
    <!--非标：按月查询标准数据,查询雇员费用段-->

</mapper>
