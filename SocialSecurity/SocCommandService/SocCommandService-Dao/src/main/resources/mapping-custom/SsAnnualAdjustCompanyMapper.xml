<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ciicsh.gto.afsupportcenter.socialsecurity.soccommandservice.dao.SsAnnualAdjustCompanyMapper">

    <select id="queryAnnualAdjustCompany" resultMap="BaseResultMap">
        SELECT
        saac.annual_adjust_company_id,
        saac.company_id,
        saac.company_name,
        saac.adjust_year,
        saac.data_collect_status,
        saac.report_status,
        saac.data_collect_time
        FROM ss_annual_adjust_company saac
        <if test="ssAccountType != null or comAccountId != null">
            INNER JOIN
            ss_account_com_relation sacr
            ON sacr.company_id=saac.company_id
            AND sacr.is_active=1
            INNER JOIN
            ss_com_account sca
            ON sca.com_account_id=sacr.com_account_id
            AND sca.is_active=1
        </if>
        <where>
            saac.is_active=1 AND saac.adjust_year = YEAR(NOW())
            <if test="ssAccountType != null">
                AND sca.ss_account_type=#{ssAccountType}
            </if>
            <if test="comAccountId != null">
                AND sca.com_account_id=#{comAccountId}
            </if>
            <if test="companyId != null">
                AND saac.company_id=#{companyId}
            </if>
        </where>
    </select>
</mapper>
