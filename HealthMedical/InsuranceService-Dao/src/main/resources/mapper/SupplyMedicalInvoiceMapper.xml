<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ciicsh.gto.afsupportcenter.healthmedical.dao.SupplyMedicalInvoiceMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.ciicsh.gto.afsupportcenter.healthmedical.entity.po.SupplyMedicalInvoice">
        <id column="invoice_id" property="invoiceId"/>
        <result column="acceptance_id" property="acceptanceId"/>
        <result column="medical_institution" property="medicalInstitution"/>
        <result column="disease_name" property="diseaseName"/>
        <result column="clinic_date" property="clinicDate"/>
        <result column="self_pay_amount" property="selfPayAmount"/>
        <result column="whole_plan_amount" property="wholePlanAmount"/>
        <result column="attach_amount" property="attachAmount"/>
        <result column="own_expense_amount" property="ownExpenseAmount"/>
        <result column="account_amount" property="accountAmount"/>
        <result column="application_amount" property="applicationAmount"/>
        <result column="claim_amount" property="claimAmount"/>
        <result column="approved_amount" property="approvedAmount"/>
        <result column="cs_payment_amount" property="csPaymentAmount"/>
        <result column="company_money" property="companyMoney"/>
        <result column="insurance_company_money" property="insuranceCompanyMoney"/>
        <result column="closed_status" property="closedStatus"/>
        <result column="closed_remark" property="closedRemark"/>
        <result column="created_time" property="createdTime"/>
        <result column="modified_time" property="modifiedTime"/>
        <result column="created_by" property="createdBy"/>
        <result column="modified_by" property="modifiedBy"/>
    </resultMap>

    <select id="queryEmployeeInfo" parameterType="java.lang.String"
            resultType="com.ciicsh.gto.afsupportcenter.healthmedical.entity.bo.EmployeeBO">
        SELECT
          employee_id                             employeeId,
          employee_name                           employeeName,
          hm_supply_medical_acceptance.company_id companyId,
          company_name                            companyName,
          start_date                              startDate,
          start_confirm_date                      startConfirmDate,
          end_date                                endDate,
          end_confirm_date                        endConfirmDate
        FROM hm_supply_medical_acceptance
          JOIN cmy_af_emp_insurance
            ON cmy_af_emp_insurance.company_id = hm_supply_medical_acceptance.company_id
        WHERE employee_id = #{employeeId,jdbcType=VARCHAR}
    </select>

    <select id="queryInvoiceCount"
            parameterType="com.ciicsh.gto.afsupportcenter.healthmedical.entity.dto.SupplyMedicalAcceptanceDTO"
            resultType="java.lang.Integer">
        SELECT count(hm_supply_medical_invoice.invoice_id)
        FROM hm_supply_medical_invoice
        JOIN hm_supply_medical_acceptance
        ON hm_supply_medical_invoice.acceptance_id = hm_supply_medical_acceptance.acceptance_id
        JOIN sal_company
        ON sal_company.company_id = hm_supply_medical_acceptance.company_id
        JOIN sal_management
        ON sal_management.management_id = sal_company.management_id
        <where>
            <if test="inputDateRange != null and inputDateRange.size == 2">
                AND input_date BETWEEN #{inputDateRange[0],jdbcType=TIMESTAMP} AND
                #{inputDateRange[1],jdbcType=TIMESTAMP}
            </if>
            <if test="auditTime != null">
                AND audit_time = #{auditTime,jdbcType=TIMESTAMP}
            </if>
            <if test="status != null">
                AND hm_supply_medical_acceptance.status = #{status,jdbcType=INTEGER}
            </if>
            <if test="dossierNumber != null and dossierNumber != '' ">
                AND dossier_number = #{dossierNumber,jdbcType=VARCHAR}
            </if>
            <if test="acceptanceId != null and acceptanceId != '' ">
                AND acceptance_id = #{acceptanceId,jdbcType=VARCHAR}
            </if>
            <if test="employeeId != null and employeeId != '' ">
                AND hm_supply_medical_acceptance.employee_id = #{employeeId,jdbcType=VARCHAR}
            </if>
            <if test="employeeName != null and employeeName != '' ">
                AND employee_name = #{employeeName,jdbcType=VARCHAR}
            </if>
            <if test="companyId != null and companyId != '' ">
                AND hm_supply_medical_acceptance.company_id = #{companyId,jdbcType=VARCHAR}
            </if>
            <if test="companyName != null and companyName != '' ">
                AND company_name = #{companyName,jdbcType=VARCHAR}
            </if>
            <if test="managementId != null and managementId != '' ">
                AND sal_company.management_id = #{managementId,jdbcType=VARCHAR}
            </if>
            <if test="managementName != null and managementName != '' ">
                AND sal_management.title = #{managementName,jdbcType=VARCHAR}
            </if>
            <if test="insuredName != null and insuredName != '' ">
                AND insured_name = #{insuredName,jdbcType=VARCHAR}
            </if>
        </where>
    </select>
</mapper>
