<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ciicsh.gto.afsupportcenter.housefund.siteservice.dao.HfComTaskMapper">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.ciicsh.gto.afsupportcenter.housefund.siteservice.entity.HfComTask">
		<id column="com_task_id" property="comTaskId" />
		<result column="com_account_id" property="comAccountId" />
		<result column="com_account_class_id" property="comAccountClassId" />
		<result column="company_id" property="companyId" />
        <result column="hf_type" property="hfType" />
		<result column="task_category" property="taskCategory" />
		<result column="submitter_id" property="submitterId" />
		<result column="submitter_name" property="submitterName" />
		<result column="submitter_dept_id" property="submitterDeptId" />
		<result column="submitter_dept_name" property="submitterDeptName" />
		<result column="submit_time" property="submitTime" />
		<result column="submit_remark" property="submitRemark" />
		<result column="handle_user_id" property="handleUserId" />
		<result column="handle_user_name" property="handleUserName" />
		<result column="strart_handle_date" property="strartHandleDate" />
		<result column="send_check_date" property="sendCheckDate" />
		<result column="finish_date" property="finishDate" />
		<result column="task_status" property="taskStatus" />
		<result column="material_sign_record" property="materialSignRecord" />
		<result column="transfer_date" property="transferDate" />
		<result column="remark" property="remark" />
		<result column="com_account_name" property="comAccountName" />
		<result column="payment_way" property="paymentWay" />
		<result column="close_day" property="closeDay" />
		<result column="hf_com_account" property="hfComAccount" />
		<result column="com_start_month" property="comStartMonth" />
		<result column="end_month" property="endMonth" />
		<result column="end_type" property="endType" />
		<result column="task_id" property="taskId" />
		<result column="is_active" property="isActive" />
		<result column="created_time" property="createdTime" />
		<result column="modified_time" property="modifiedTime" />
		<result column="created_by" property="createdBy" />
		<result column="modified_by" property="modifiedBy" />
	</resultMap>

    <resultMap id="HfComTaskBOResultMap"
               type="com.ciicsh.gto.afsupportcenter.housefund.siteservice.bo.HfComTaskBo"
               extends="BaseResultMap">
        <result column="company_name" property="companyName"/>
        <result column="task_category_name" property="taskCategoryName"/>
        <result column="hf_type_name" property="hfTypeName"/>
        <result column="com_task_payment_way_name" property="comTaskPaymentWayName"/>
        <result column="hf_com_account" property="hfComAccount"/>
        <result column="com_account_state_value" property="comAccountStateValue"/>
        <result column="payment_bank_value" property="paymentBankValue"/>
        <result column="end_month" property="endMonth"/>
        <result column="ukstore_value" property="ukStoreValue"/>
        <result column="type_value" property="typeValue"/>
    </resultMap>

    <!--查询公积金企业任务单 未处理状态-->
    <select id="queryNoProcessCompanyTask" resultMap="HfComTaskBOResultMap">
        SELECT
        hft.com_task_id,
        hcac.hf_com_account,
        ctc.task_category_name,
        ht.hf_type_name,
        hft.hf_type,
        hft.company_id,
        cc.title as company_name,
        hft.handle_user_id,
        hft.handle_user_name,
        hft.submitter_id,
        hft.submitter_name,
        hft.submit_time,
        hft.submit_remark,
        hft.com_account_name,
        hft.close_day,
        hft.payment_way,
        ctpw.com_task_payment_way_name,
        hcac.hf_com_account,
        hcas.com_account_state_value,
        hcapb.payment_bank_value,
        hft.end_month,
        hcau.ukstore_value,
        hcat.type_value,
        hft.task_status
        FROM hf_com_task hft
        LEFT JOIN hf_com_account hca ON hft.com_account_id = hca.com_account_id
        LEFT JOIN hf_com_account_state hcas ON hca.state = hcas.com_account_state_code
        LEFT JOIN hf_com_account_payment_bank hcapb ON hca.payment_bank = hcapb.payment_bank_code
        LEFT JOIN hf_com_account_ukstore hcau ON hca.ukey_store = hcau.ukstore_code
        LEFT JOIN hf_com_account_type hcat ON hca.hf_account_type = hcat.type_code
        LEFT JOIN hf_com_account_class hcac ON hft.com_account_class_id = hcac.com_account_class_id
        LEFT JOIN sal_company cc ON hft.company_id = cc.company_id
        LEFT JOIN hf_com_task_category ctc ON hft.task_category = ctc.task_category_code
        LEFT JOIN hf_type ht ON hft.hf_type = ht.hf_type_code
        LEFT JOIN hf_com_task_payment_way ctpw ON hft.payment_way = ctpw.com_task_payment_way_code
        <where>
            AND hft.is_active = 1
            AND hft.task_status = 0
            <if test="companyName!= null">
                AND cc.title LIKE CONCAT('%', #{companyName}, '%')
            </if>
            <if test="taskCategory!= null">
                AND hft.task_category = #{taskCategory}
            </if>
            <if test="companyId!= null">
                AND hft.company_id = #{companyId}
            </if>
            <if test="hfTypeName!= null">
                AND ht.hf_type_name = TRIM(#{hfTypeName})
            </if>
        </where>
    </select>

</mapper>
